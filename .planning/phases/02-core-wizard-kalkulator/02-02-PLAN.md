---
phase: 02-core-wizard-kalkulator
plan: 02
type: execute
wave: 2
depends_on: [02-01]
files_modified:
  - src/pages/WizardPage.tsx
  - src/components/wizard/WizardProgress.tsx
  - src/components/wizard/WizardNav.tsx
  - src/components/wizard/RoomsStep.tsx
  - src/components/wizard/RoomCard.tsx
  - src/components/wizard/DimensionsStep.tsx
  - src/components/wizard/FloatingSummary.tsx
  - src/components/wizard/AnimatedCounter.tsx
  - src/router/index.tsx
  - src/pages/HomePage.tsx
  - public/sounds/pop.mp3
  - public/sounds/success.mp3
autonomous: true

must_haves:
  truths:
    - "Uzytkownik klika CTA na stronie glownej i przechodzi do wizarda (/wizard)"
    - "Uzytkownik widzi pasek postepu z 4 krokami i wie w ktorym kroku jest"
    - "Uzytkownik moze dodac pokoje z kart z ikonami, usunac pokoj, edytowac nazwe pokoju"
    - "Uzytkownik moze podac wymiary per pokoj (sciany, sufity, posadzka, narozniki, bruzdy, akryl) z automatycznym przeliczaniem sumy netto"
    - "Przejscia miedzy krokami sa animowane (slide left/right z motion)"
    - "Uzytkownik moze cofnac sie do poprzedniego kroku bez utraty danych"
    - "Plywajacy pasek podsumowania pokazuje sume netto/VAT/brutto z animowanym licznikiem i selektorem VAT"
    - "Dodanie pokoju odgrywa subtelny dzwiek pop, dotarcie do kroku Summary odgrywa dzwiek sukcesu (UI-07)"
  artifacts:
    - path: "src/pages/WizardPage.tsx"
      provides: "Kontroler krokow wizarda z AnimatePresence"
      contains: "AnimatePresence"
    - path: "src/components/wizard/WizardProgress.tsx"
      provides: "Pasek postepu z krokami"
      contains: "Progress"
    - path: "src/components/wizard/RoomsStep.tsx"
      provides: "Krok 1 -- wybor pokoi z kartami"
      contains: "addRoom"
    - path: "src/components/wizard/DimensionsStep.tsx"
      provides: "Krok 2 -- inputy wymiarow per pokoj"
      contains: "updateDimension"
    - path: "src/components/wizard/FloatingSummary.tsx"
      provides: "Plywajacy pasek kosztow"
      contains: "calcNetTotal"
    - path: "src/router/index.tsx"
      provides: "Route /wizard"
      contains: "wizard"
  key_links:
    - from: "src/pages/WizardPage.tsx"
      to: "src/stores/wizard-store.ts"
      via: "useWizardStore selectors"
      pattern: "useWizardStore"
    - from: "src/components/wizard/RoomsStep.tsx"
      to: "src/stores/wizard-store.ts"
      via: "addRoom, removeRoom, updateRoomName"
      pattern: "useWizardStore"
    - from: "src/components/wizard/DimensionsStep.tsx"
      to: "src/stores/wizard-store.ts"
      via: "updateDimension"
      pattern: "updateDimension"
    - from: "src/components/wizard/FloatingSummary.tsx"
      to: "src/lib/calc.ts"
      via: "calcNetTotal, calcGrossFromNet"
      pattern: "calcNetTotal"
    - from: "src/router/index.tsx"
      to: "src/pages/WizardPage.tsx"
      via: "route /wizard"
      pattern: "WizardPage"
    - from: "src/pages/HomePage.tsx"
      to: "src/router/index.tsx"
      via: "Link to /wizard"
      pattern: "/wizard"
---

<objective>
Zbudowac powloke wizarda (WizardPage z animowanymi przejsciami, pasek postepu, nawigacja Wstecz/Dalej), kroki RoomsStep i DimensionsStep, plywajacy pasek podsumowania z animowanym licznikiem, oraz podlaczyc route /wizard i CTA ze strony glownej.

Purpose: To pierwsza warstwa UI calego kalkulatora -- uzytkownik moze dodac pokoje, podac wymiary i widziec koszty na zywo. Bez tego zadne kroki wizarda nie sa dostepne.
Output: Dzialajacy wizard z krokami 1-2 (pokoje, wymiary), paskiem postepu, plywajacym podsumowaniem, animacjami i nawigacja.
</objective>

<execution_context>
@/Users/wojciecholszak/.claude/get-shit-done/workflows/execute-plan.md
@/Users/wojciecholszak/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-wizard-kalkulator/02-RESEARCH.md
@.planning/phases/02-core-wizard-kalkulator/02-01-SUMMARY.md
@src/types/wizard.ts
@src/stores/wizard-store.ts
@src/lib/calc.ts
@src/lib/format.ts
@src/router/index.tsx
@src/pages/HomePage.tsx
@src/components/layout/Layout.tsx
@src/i18n/locales/pl/common.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: WizardPage, progress bar, navigation, animated transitions, route/CTA link, sound files</name>
  <files>src/pages/WizardPage.tsx, src/components/wizard/WizardProgress.tsx, src/components/wizard/WizardNav.tsx, src/router/index.tsx, src/pages/HomePage.tsx, public/sounds/pop.mp3, public/sounds/success.mp3</files>
  <action>
**public/sounds/ -- Pliki dzwiekowe (UI-07):**

Create directory `public/sounds/`. Download two small, royalty-free MP3 sound files:
1. `public/sounds/pop.mp3` -- a subtle, short pop/click sound (~50-100ms). Download from: `curl -o public/sounds/pop.mp3 "https://cdn.pixabay.com/audio/2022/03/24/audio_805cb7e0b7.mp3"` (Pixabay pop sound, royalty-free). If the URL is unavailable, create a minimal silent MP3 placeholder and add a TODO comment. Alternatively generate a tiny MP3 with ffmpeg: `ffmpeg -f lavfi -i "sine=frequency=800:duration=0.08" -ar 44100 -b:a 32k public/sounds/pop.mp3`.
2. `public/sounds/success.mp3` -- a short success/completion chime (~300-500ms). Download from: `curl -o public/sounds/success.mp3 "https://cdn.pixabay.com/audio/2022/03/15/audio_115b9b3c6e.mp3"` (Pixabay success sound, royalty-free). If the URL is unavailable, generate with ffmpeg: `ffmpeg -f lavfi -i "sine=frequency=600:duration=0.15,sine=frequency=900:duration=0.15" -filter_complex "[0][1]concat=n=2:v=0:a=1" -ar 44100 -b:a 32k public/sounds/success.mp3`.

Keep the files tiny (under 50KB each). These are served as static assets from public/ and loaded by use-sound.

**src/pages/WizardPage.tsx** -- Kontroler krokow wizarda:

Import { AnimatePresence, motion } from 'motion/react'. Import useWizardStore (currentStep, nextStep, prevStep). Import step components: RoomsStep, DimensionsStep. For steps 2 and 3 (WorksStep, SummaryStep) render placeholder divs with text "WorksStep" / "SummaryStep" -- te zostaną zbudowane w planie 02-03. Import useSound from 'use-sound'.

Track `direction` state ('forward' | 'backward') using useRef or useState -- set to 'forward' on nextStep, 'backward' on prevStep. Pass direction as `custom` prop to AnimatePresence.

**Sound effects (UI-07):** Initialize a success sound hook:
```typescript
const [playSuccess] = useSound('/sounds/success.mp3', { volume: 0.4 })
```
In the onNext callback (when user clicks "Dalej"), after calling nextStep, check if the NEW step is the Summary step (index 3). If so, call `playSuccess()`. This gives a satisfying completion sound when the user reaches the final summary.

Variants for slide animation (from Research Pattern 2):
```typescript
const variants = {
  enter: (direction: string) => ({
    x: direction === 'forward' ? 40 : -40,
    opacity: 0,
  }),
  center: { x: 0, opacity: 1 },
  exit: (direction: string) => ({
    x: direction === 'forward' ? -40 : 40,
    opacity: 0,
  }),
}
```

Use AnimatePresence mode="wait" with key={currentStep} wrapping motion.div containing the step component. Transition: duration 0.25, ease 'easeInOut'.

Layout: Container div with max-w-4xl mx-auto. At top: WizardProgress. Below: AnimatePresence with steps. At bottom: WizardNav. Also render FloatingSummary (which will be a separate component floating at bottom of viewport).

**src/components/wizard/WizardProgress.tsx** -- Pasek postepu:

Import shadcn Progress component from @/components/ui/progress. Import useTranslation for step labels.

Define WIZARD_STEPS = ['wizard.steps.rooms', 'wizard.steps.dimensions', 'wizard.steps.works', 'wizard.steps.summary'] as const.

Props: currentStep: number. Calculate progress = ((currentStep + 1) / 4) * 100.

Render: Progress component with value={progress} and className="h-2". Below it, a flex row with 4 step labels. Current step: text-foreground font-medium. Past steps: text-foreground/70. Future: text-muted-foreground. Also show step number indicator (e.g. "1", "2", "3", "4") as small circles. Active step gets bg-brand text-brand-foreground, past steps get bg-primary text-primary-foreground, future get bg-muted.

Use `t()` for translating step labels from i18n keys.

**src/components/wizard/WizardNav.tsx** -- Nawigacja Wstecz/Dalej:

Props: none (reads from store directly). Import useWizardStore for currentStep, nextStep, prevStep, rooms. Import Button from shadcn. Import useTranslation.

Render flex row with justify-between:
- Left: "Wstecz" button (t('wizard.prev')), variant="outline", disabled when currentStep === 0, onClick calls prevStep
- Right: "Dalej" button (t('wizard.next')), variant="default" with bg-brand styling, disabled when:
  - Step 0 (rooms): rooms.length === 0 (must have at least 1 room)
  - Step 3 (summary): show "Zakoncz" (t('wizard.finish')) instead, no disable
- When clicking next/prev, also update direction ref in WizardPage. To do this: WizardNav receives onNext and onPrev callbacks from WizardPage that set direction and call nextStep/prevStep.

**src/router/index.tsx** -- Dodaj route /wizard:

Add lazy import for WizardPage: `const WizardPage = lazy(() => import('@/pages/WizardPage'))`. Wrap in Suspense with skeleton/spinner fallback.

Add route under Layout children: `{ path: "wizard", element: <Suspense fallback={<WizardPageSkeleton />}><WizardPage /></Suspense> }`.

Create a `WizardPageSkeleton` inline component (or co-locate at bottom of router/index.tsx) that renders a skeleton layout matching the wizard page structure. Import Skeleton from '@/components/ui/skeleton'. The skeleton should render:
```tsx
function WizardPageSkeleton() {
  return (
    <div className="mx-auto max-w-4xl space-y-6 p-4">
      {/* Progress bar skeleton */}
      <Skeleton className="h-2 w-full rounded-full" />
      <div className="flex justify-between">
        {Array.from({ length: 4 }).map((_, i) => (
          <Skeleton key={i} className="h-4 w-20" />
        ))}
      </div>
      {/* Step content skeleton */}
      <div className="space-y-4 pt-6">
        <Skeleton className="h-8 w-48" />
        <div className="grid grid-cols-2 gap-3 sm:grid-cols-3 lg:grid-cols-4">
          {Array.from({ length: 7 }).map((_, i) => (
            <Skeleton key={i} className="h-24 rounded-lg" />
          ))}
        </div>
      </div>
      {/* Nav skeleton */}
      <div className="flex justify-between pt-4">
        <Skeleton className="h-10 w-24" />
        <Skeleton className="h-10 w-24" />
      </div>
    </div>
  )
}
```
This satisfies UI-06 (Skeleton loaders) by showing a proper skeleton layout while the WizardPage lazy chunk loads.

Use React.lazy and React.Suspense for code splitting. Import them from 'react'.

**src/pages/HomePage.tsx** -- Podlacz CTA do /wizard:

Import { Link } from 'react-router'. Wrap the Button in CTA section with `<Link to="/wizard">`. The Button should use asChild prop pattern OR wrap with Link directly. Simplest: replace `<Button>` with `<Link to="/wizard"><Button ...>{t("home.cta")}</Button></Link>`.

UWAGA: uzywaj HashRouter -- Link to="/wizard" przejdzie do /#/wizard.
  </action>
  <verify>
`pnpm build` przechodzi. Route /wizard renderuje WizardPage. Suspense fallback pokazuje Skeleton layout (nie pusty div). Przycisk CTA na HomePage prowadzi do /wizard. Kliknięcie Dalej/Wstecz zmienia kroki z animacja. Pasek postepu aktualizuje sie. Pliki public/sounds/pop.mp3 i public/sounds/success.mp3 istnieja. Dotarcie do kroku Summary odgrywa dzwiek sukcesu.
  </verify>
  <done>WizardPage z 4 krokami renderuje sie pod /wizard. Suspense fallback uzywa Skeleton (UI-06). Progress bar pokazuje aktualny krok. Nawigacja Wstecz/Dalej dziala z animowanymi przejsciami. CTA na HomePage prowadzi do /wizard. Kroki 2-3 sa placeholderami. Dzwiek sukcesu odgrywa sie przy dotarciu do Summary (UI-07). Pliki dzwiekowe w public/sounds/.</done>
</task>

<task type="auto">
  <name>Task 2: RoomsStep with interactive cards, add/remove/edit, and DimensionsStep with per-room inputs</name>
  <files>src/components/wizard/RoomsStep.tsx, src/components/wizard/RoomCard.tsx, src/components/wizard/DimensionsStep.tsx, src/components/wizard/FloatingSummary.tsx, src/components/wizard/AnimatedCounter.tsx</files>
  <action>
**src/components/wizard/RoomsStep.tsx** -- Krok 1: wybor pokoi:

Import ROOM_TYPES from @/types/wizard. Import useWizardStore (rooms, addRoom, removeRoom, updateRoomName). Import useTranslation. Import RoomCard. Import Card from shadcn. Import useSound from 'use-sound'.

**Sound effects (UI-07):** At top of RoomsStep component, initialize sound hooks:
```typescript
const [playPop] = useSound('/sounds/pop.mp3', { volume: 0.5 })
```
Call `playPop()` immediately after every `addRoom(type, t(labelKey))` call. This gives satisfying audio feedback when user adds a room.

Layout:
1. Top section: heading t('rooms.selectType') with grid of 7 room type cards (ROOM_TYPES). Grid: grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3. Each card shows Lucide icon + translated label. On click: addRoom(type, t(labelKey)) then playPop(). Use Lucide icons dynamically -- import all needed icons: CookingPot, Bath, Sofa, Bed, DoorOpen, Monitor, LayoutGrid from 'lucide-react'. Create a map from icon name string to component: `const ICON_MAP: Record<string, LucideIcon> = { CookingPot, Bath, Sofa, Bed, DoorOpen, Monitor, LayoutGrid }`. Render icon from map.

Room type card: shadcn Card with hover:border-brand/50 transition, cursor-pointer. Padding p-4. Center icon (size 32, text-muted-foreground) and label below. On hover: scale slightly with Tailwind hover:scale-[1.02] transition-transform.

2. Bottom section: list of added rooms. If rooms.length === 0, show empty state: t('rooms.empty') in muted text. If rooms exist, render RoomCard for each room.

**src/components/wizard/RoomCard.tsx** -- Karta dodanego pokoju:

Props: room: Room (the room object).

Import useWizardStore (removeRoom, updateRoomName). Import Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter from shadcn dialog. Import Button, Input. Import useTranslation. Import Lucide icons (Trash2, Pencil) and the ICON_MAP.

Render: shadcn Card with flex row. Left: icon for room type (from ICON_MAP using ROOM_TYPES lookup). Center: room name (editable). Right: edit button (Pencil icon) and delete button (Trash2 icon, variant="ghost", text-destructive).

Edit name: clicking Pencil opens Dialog with Input for new name. DialogFooter with Cancel and Save buttons. Save calls updateRoomName(room.id, newName).

Delete: clicking Trash2 calls removeRoom(room.id). Add a motion.div wrapper with layout and exit animation (opacity 0, height 0, transition duration 0.2) for smooth removal.

**src/components/wizard/DimensionsStep.tsx** -- Krok 2: wymiary per pokoj:

Import useWizardStore (rooms, updateDimension). Import useTranslation. Import Input from shadcn. Import calcRoomNetArea from @/lib/calc.ts. Import Badge from shadcn.

Layout: For each room, render a section with room name as heading. Use Accordion or tabs if many rooms, but simpler: vertical stacked sections separated by dividers.

Each room section contains:
1. **Sciany (walls)**: Heading t('dimensions.walls') + badge showing count. List of wall inputs (number, step=0.01, placeholder="m2"). Button t('dimensions.addWall') to add wall (push 0 to walls array via updateDimension). Each wall has a remove button (X icon). When input changes: parse value, create new array with updated value, call updateDimension(roomId, 'walls', newArray).

2. **Sufity (ceilings)**: Same pattern as walls. Heading t('dimensions.ceilings'). Add/remove ceiling inputs.

3. **Posadzka (floor)**: Single number input. t('dimensions.floor'). updateDimension(roomId, 'floor', value).

4. **Narozniki (corners)**: Single number input in mb. t('dimensions.corners').

5. **Bruzdy (grooves)**: Single number input in mb. t('dimensions.grooves').

6. **Akrylowanie (acrylic)**: Single number input in mb. t('dimensions.acrylic').

7. **Powierzchnia netto**: Display calcRoomNetArea(room) with unit m2. Bold, highlighted. Show as Badge variant="secondary" or a styled div.

Each input: type="number", step="0.01", min="0", className styling from shadcn Input. Show unit label (m2 or mb) next to input. Parse input value to number on change -- use parseFloat, default to 0 if NaN.

WAZNE: Wymiary sa w metrach (nie groszach). Store przechowuje surowe liczby (np. 12.5 m2). Przeliczanie na grosze dotyczy TYLKO cen, nie wymiarow.

**src/components/wizard/FloatingSummary.tsx** -- Plywajacy pasek podsumowania:

Import useWizardStore (rooms, vatRate, setVatRate). Import calcNetTotal, calcVat, calcGrossFromNet from @/lib/calc. Import AnimatedCounter. Import motion from 'motion/react'. Import useTranslation. Import Button from shadcn.

Fixed position bar at bottom of viewport: className="fixed bottom-0 left-0 right-0 z-50". Glassmorphism: border-t border-border/50 bg-background/80 backdrop-blur-lg. Animate entrance with motion.div (initial y:100, animate y:0, spring stiffness 300 damping 30).

Content: container mx-auto flex items-center justify-between px-4 py-3.

Left side: three values in a flex row with gap-4 sm:gap-6:
- Netto: AnimatedCounter value={net}
- VAT {vatRate}%: AnimatedCounter value={vat}
- Brutto: AnimatedCounter value={gross} (larger font, font-bold)

Right side: VAT selector -- two buttons (8%, 23%) as toggle group. Active button: bg-brand text-brand-foreground. Inactive: variant="outline". On click: setVatRate(8) or setVatRate(23).

Calculate: const net = calcNetTotal(rooms); const vat = calcVat(net, vatRate); const gross = calcGrossFromNet(net, vatRate).

**src/components/wizard/AnimatedCounter.tsx** -- Animowany licznik:

Import useSpring, useTransform, motion from 'motion/react'. Import useEffect from 'react'.

Props: value: number (grosze), locale?: string (default 'pl-PL').

Implementation from Research Pattern 3:
```typescript
const spring = useSpring(0, { mass: 0.8, stiffness: 75, damping: 15 })
useEffect(() => { spring.set(value) }, [spring, value])
const display = useTransform(spring, (v) =>
  new Intl.NumberFormat(locale, { style: 'currency', currency: 'PLN', minimumFractionDigits: 2 }).format(v / 100)
)
return <motion.span>{display}</motion.span>
```

Render: motion.span element displaying the formatted value. The spring animation gives smooth counting effect when value changes.

UWAGA na responsywnosc FloatingSummary: na mobile (sm:) ukryj etykiety "Netto"/"VAT", pokaz tylko kwoty. Na bardzo malych ekranach pokaz tylko brutto. Na desktop pokaz wszystko. Main content needs padding-bottom (pb-20) aby nie bylo przykryte przez FloatingSummary -- dodaj pb-20 do WizardPage container.
  </action>
  <verify>
`pnpm build` przechodzi. Dodanie pokoju przez karte jest widoczne w liscie ponizej i odgrywa dzwiek pop (UI-07). Usuwanie pokoju animowane. Edycja nazwy przez dialog dziala. Wymiary per pokoj: dodawanie scian, sufitow, zmiana posadzki/naroznikow/bruzd/akrylu. Powierzchnia netto przelicza sie automatycznie. FloatingSummary pokazuje 0.00 zl poki nie ma prac z cenami. AnimatedCounter plynnie animuje zmiane wartosci.
  </verify>
  <done>RoomsStep pozwala dodac/usunac/edytowac pokoje z interaktywnymi kartami z ikonami Lucide. Dodanie pokoju odgrywa subtelny dzwiek pop (UI-07 use-sound). DimensionsStep pozwala podac wszystkie wymiary per pokoj z dynamicznym dodawaniem scian/sufitow i automatycznym obliczaniem powierzchni netto. FloatingSummary plywajacy pasek z animowanym licznikiem netto/VAT/brutto i selektorem VAT 8%/23%. Caly UI podlaczony do Zustand store.</done>
</task>

</tasks>

<verification>
1. `pnpm build` przechodzi bez bledow TypeScript
2. Route /wizard renderuje WizardPage z krokami, progressem i nawigacja
3. CTA na HomePage przenosi do /wizard
4. Dodawanie pokoi z kart, usuwanie, edycja nazwy -- stan persystuje w store
5. Wymiary per pokoj z automatyczna suma netto
6. Animowane przejscia miedzy krokami (motion AnimatePresence)
7. FloatingSummary z AnimatedCounter reaguje na zmiany danych
8. Nawigacja Wstecz/Dalej dziala, cofanie bez utraty danych
9. Pasek postepu wizualnie odpowiada aktualnemu krokowi
</verification>

<success_criteria>
- Uzytkownik klika "Rozpocznij wycene" na stronie glownej i trafia do wizarda
- Pasek postepu pokazuje "Pomieszczenia" jako aktywny krok 1 z 4
- Uzytkownik klika karte "Kuchnia" i widzi dodany pokoj na liscie
- Uzytkownik klika "Dalej" i widzi animowane przejscie do kroku Wymiary
- Uzytkownik wpisuje wymiary scian/posadzki i widzi przeliczona powierzchnie netto
- Uzytkownik klika "Wstecz" i wraca do kroku Pomieszczenia z zachowanymi danymi
- Plywajacy pasek na dole pokazuje 0,00 zl (brak prac z cenami jeszcze)
- Selektor VAT przelacza miedzy 8% a 23%
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-wizard-kalkulator/02-02-SUMMARY.md`
</output>
