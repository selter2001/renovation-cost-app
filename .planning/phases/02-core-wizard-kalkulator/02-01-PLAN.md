---
phase: 02-core-wizard-kalkulator
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/types/wizard.ts
  - src/stores/wizard-store.ts
  - src/lib/calc.ts
  - src/lib/format.ts
  - src/i18n/locales/pl/common.json
  - src/i18n/locales/en/common.json
  - src/components/ui/progress.tsx
  - src/components/ui/skeleton.tsx
  - src/components/ui/card.tsx
  - src/components/ui/input.tsx
  - src/components/ui/switch.tsx
  - src/components/ui/badge.tsx
  - src/components/ui/dialog.tsx
autonomous: true

must_haves:
  truths:
    - "Zustand store przechowuje stan wizarda (rooms, currentStep, vatRate) i persystuje do localStorage pod kluczem renocost-wizard-v1"
    - "Funkcje kalkulacji dzialaja na groszach (integer) -- calcWorkCost, calcRoomTotal, calcGrossFromNet zwracaja poprawne wartosci"
    - "formatPLN formatuje grosze do czytelnego formatu PLN z Intl.NumberFormat"
    - "Typy TypeScript (Room, WizardState, WorkType) sa eksportowane i uzywalne w calym projekcie"
  artifacts:
    - path: "src/types/wizard.ts"
      provides: "Typy Room, RoomType, WorkType, CustomWork, WizardState"
      exports: ["Room", "RoomType", "WorkType", "CustomWork", "PREDEFINED_WORKS", "ROOM_TYPES"]
    - path: "src/stores/wizard-store.ts"
      provides: "Zustand store z immer + persist middleware"
      exports: ["useWizardStore"]
    - path: "src/lib/calc.ts"
      provides: "Kalkulacje kosztow na groszach"
      exports: ["calcWorkCost", "calcRoomTotal", "calcNetTotal", "calcGrossFromNet", "calcRoomNetArea", "getWorkQuantity"]
    - path: "src/lib/format.ts"
      provides: "Formatowanie walut PLN"
      exports: ["formatPLN", "parseInputToGrosze"]
  key_links:
    - from: "src/stores/wizard-store.ts"
      to: "src/types/wizard.ts"
      via: "import typow Room, RoomType"
      pattern: "import.*from.*@/types/wizard"
    - from: "src/lib/calc.ts"
      to: "src/types/wizard.ts"
      via: "import typu Room"
      pattern: "import.*Room.*from.*@/types/wizard"
---

<objective>
Zainstalowac zaleznosci Phase 2, stworzyc typy danych, Zustand store z persystencja, silnik kalkulacji na groszach i klucze i18n dla wizarda.

Purpose: Fundament danych i logiki -- wszystkie kolejne plany (wizard UI, pokoje, wymiary, prace, PDF) zaleза od typow, store'a i kalkulacji.
Output: Dzialajacy store z CRUD na pokojach, poprawna arytmetyka groszowa, shadcn komponenty gotowe do uzycia.
</objective>

<execution_context>
@/Users/wojciecholszak/.claude/get-shit-done/workflows/execute-plan.md
@/Users/wojciecholszak/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-wizard-kalkulator/02-RESEARCH.md
@.planning/phases/01-foundation-design-system/01-01-SUMMARY.md
@.planning/phases/01-foundation-design-system/01-02-SUMMARY.md
@src/i18n/locales/pl/common.json
@src/i18n/locales/en/common.json
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Instalacja zaleznosci i shadcn komponentow</name>
  <files>package.json</files>
  <action>
Zainstaluj zaleznosci Phase 2:
```bash
pnpm add zustand immer motion @react-pdf/renderer use-sound
pnpm dlx shadcn@latest add progress skeleton card input switch badge dialog
```

Po instalacji zweryfikuj:
- `@react-pdf/renderer` >= 4.3.2 (React 19 compat) -- sprawdz `node_modules/@react-pdf/renderer/package.json`
- shadcn CLI moze tworzyc pliki pod @/ zamiast src/ -- jezeli tak, przenies recznie do src/components/ui/
- Jezeli use-sound zglasza peer dep warning, dodaj z `--legacy-peer-deps`

UWAGA: shadcn CLI w tym projekcie tworzy pliki pod @/components/ui/ (dosłowny katalog "@/"). Sprawdz czy tak sie stalo i przenies pliki do src/components/ui/. Usun katalog @/ jezeli zostal stworzony.
  </action>
  <verify>
`pnpm build` przechodzi bez bledow. `ls src/components/ui/` zawiera progress.tsx, skeleton.tsx, card.tsx, input.tsx, switch.tsx, badge.tsx, dialog.tsx.
  </verify>
  <done>Wszystkie zaleznosci zainstalowane, shadcn komponenty w src/components/ui/, projekt buduje sie bez bledow.</done>
</task>

<task type="auto">
  <name>Task 2: Typy, store Zustand i kalkulacje</name>
  <files>src/types/wizard.ts, src/stores/wizard-store.ts, src/lib/calc.ts, src/lib/format.ts</files>
  <action>
**src/types/wizard.ts** -- typy danych:

```typescript
export type RoomType = 'kitchen' | 'bathroom' | 'living' | 'bedroom' | 'hallway' | 'office' | 'other'

// Predefiniowane typy pokoi z ikonami (Lucide icon names)
export const ROOM_TYPES: { type: RoomType; icon: string; labelKey: string }[] = [
  { type: 'kitchen', icon: 'CookingPot', labelKey: 'rooms.types.kitchen' },
  { type: 'bathroom', icon: 'Bath', labelKey: 'rooms.types.bathroom' },
  { type: 'living', icon: 'Sofa', labelKey: 'rooms.types.living' },
  { type: 'bedroom', icon: 'Bed', labelKey: 'rooms.types.bedroom' },
  { type: 'hallway', icon: 'DoorOpen', labelKey: 'rooms.types.hallway' },
  { type: 'office', icon: 'Monitor', labelKey: 'rooms.types.office' },
  { type: 'other', icon: 'LayoutGrid', labelKey: 'rooms.types.other' },
]

export type WorkUnit = 'm2' | 'mb' | 'szt'

export interface WorkType {
  id: string
  labelKey: string       // klucz i18n
  unit: WorkUnit
  dimensionKey: string   // klucz w Room.dimensions do automatycznego obliczania ilosci
}

// 7 predefiniowanych typow prac
export const PREDEFINED_WORKS: WorkType[] = [
  { id: 'painting', labelKey: 'works.types.painting', unit: 'm2', dimensionKey: 'netArea' },
  { id: 'priming', labelKey: 'works.types.priming', unit: 'm2', dimensionKey: 'netArea' },
  { id: 'plastering', labelKey: 'works.types.plastering', unit: 'm2', dimensionKey: 'netArea' },
  { id: 'floor-protection', labelKey: 'works.types.floorProtection', unit: 'm2', dimensionKey: 'floor' },
  { id: 'corners', labelKey: 'works.types.corners', unit: 'mb', dimensionKey: 'corners' },
  { id: 'grooves', labelKey: 'works.types.grooves', unit: 'mb', dimensionKey: 'grooves' },
  { id: 'acrylic', labelKey: 'works.types.acrylic', unit: 'mb', dimensionKey: 'acrylic' },
]

export interface CustomWork {
  id: string
  name: string           // nazwa wpisana przez uzytkownika (nie klucz i18n)
  unit: WorkUnit
  quantity: number       // ilosc wpisana recznie (custom works nie obliczaja z wymiarow)
}

export interface RoomWork {
  enabled: boolean
  unitPrice: number      // w groszach (integer)
}

export interface Room {
  id: string
  type: RoomType
  name: string           // domyslnie przetlumaczona nazwa typu, edytowalna
  dimensions: {
    walls: number[]      // m2, wiele scian
    ceilings: number[]   // m2, wiele sufitow
    floor: number        // m2
    corners: number      // mb
    grooves: number      // mb
    acrylic: number      // mb
  }
  works: Record<string, RoomWork>  // klucz = workId z PREDEFINED_WORKS
  customWorks: CustomWork[]
}
```

**src/stores/wizard-store.ts** -- Zustand store z immer + persist:

Postepuj dokladnie wg wzorca z Research (Pattern 1 + Pattern 6):
- Middleware: `persist(immer((set) => ...))` -- devtools pomijamy w produkcji, dodamy pozniej
- Persist key: `'renocost-wizard-v1'`
- Partialize: zapisuj rooms, vatRate, customWorks -- NIE currentStep (zaczynamy od kroku 0 po odswiezeniu)
- Storage: `createJSONStorage(() => localStorage)`
- Version: 1

Akcje store:
- `setStep(step: number)` -- ustaw aktualny krok
- `nextStep()` -- currentStep + 1 (max 3)
- `prevStep()` -- currentStep - 1 (min 0)
- `addRoom(type: RoomType, name: string)` -- push nowy Room z crypto.randomUUID()
- `removeRoom(id: string)` -- filter
- `updateRoomName(id: string, name: string)` -- znajdz i zmien
- `updateDimension(roomId: string, field: string, value: number | number[])` -- update konkretnego wymiaru
- `toggleWork(roomId: string, workId: string)` -- toggle enabled
- `setWorkPrice(roomId: string, workId: string, priceInGrosze: number)` -- ustaw cene
- `addCustomWork(roomId: string, work: Omit<CustomWork, 'id'>)` -- dodaj z crypto.randomUUID()
- `removeCustomWork(roomId: string, workId: string)` -- usun
- `updateCustomWork(roomId: string, workId: string, updates: Partial<CustomWork>)` -- update
- `setVatRate(rate: 8 | 23)` -- ustaw stawke VAT
- `resetWizard()` -- wyczysc do stanu poczatkowego

**src/lib/calc.ts** -- kalkulacje na groszach:

Wszystkie funkcje czyste, eksportowane. Importuj typ Room z wizard.ts.
- `calcRoomNetArea(room: Room): number` -- suma walls[] + ceilings[] (m2)
- `getWorkQuantity(room: Room, workId: string): number` -- zwroc ilosc z wymiarow wg dimensionKey (painting/priming/plastering -> netArea, floor-protection -> floor, corners -> corners, grooves -> grooves, acrylic -> acrylic). Dla nieznanych workId zwroc 0.
- `calcWorkCost(quantity: number, unitPriceGrosze: number): number` -- Math.round(quantity * unitPriceGrosze)
- `calcRoomTotal(room: Room): number` -- suma kosztow aktywnych prac + custom works
- `calcCustomWorkCost(work: CustomWork, unitPriceGrosze: number): number` -- Math.round(work.quantity * unitPriceGrosze)
- `calcNetTotal(rooms: Room[]): number` -- suma calcRoomTotal per pokoj
- `calcVat(netGrosze: number, vatRate: 8 | 23): number` -- Math.round(netGrosze * vatRate / 100)
- `calcGrossFromNet(netGrosze: number, vatRate: 8 | 23): number` -- netGrosze + calcVat(...)

**src/lib/format.ts** -- formatowanie:

- `formatPLN(grosze: number, locale?: string): string` -- Intl.NumberFormat z style 'currency', currency 'PLN'. Domyslny locale 'pl-PL'. Dzieli grosze / 100.
- `parseInputToGrosze(input: string): number` -- parsuje string z inputa (np. "12.50" lub "12,50") do groszy (1250). Zamienia przecinek na kropke, parseFloat, Math.round(* 100). Zwraca 0 dla NaN.
  </action>
  <verify>
`pnpm build` przechodzi. Importy miedzy plikami sa poprawne (brak circular dependencies). Typy eksportowane poprawnie.
  </verify>
  <done>
Typy Room/WorkType/CustomWork eksportowane z wizard.ts. Store useWizardStore eksportowany z wizard-store.ts z CRUD na rooms, persist do localStorage. Funkcje calc eksportowane z calc.ts (arytmetyka groszowa). formatPLN i parseInputToGrosze eksportowane z format.ts.
  </done>
</task>

<task type="auto">
  <name>Task 3: Klucze i18n dla wizarda</name>
  <files>src/i18n/locales/pl/common.json, src/i18n/locales/en/common.json</files>
  <action>
Rozszerz istniejace pliki tlumaczen o klucze dla wizarda. NIE usuwaj istniejacych kluczy (app, nav, home, common).

Dodaj nastepujace sekcje:

**wizard** -- kroki i nawigacja:
- `wizard.steps.rooms` -- "Pomieszczenia" / "Rooms"
- `wizard.steps.dimensions` -- "Wymiary" / "Dimensions"
- `wizard.steps.works` -- "Prace" / "Works"
- `wizard.steps.summary` -- "Podsumowanie" / "Summary"
- `wizard.next` -- "Dalej" / "Next"
- `wizard.prev` -- "Wstecz" / "Back"
- `wizard.finish` -- "Zakończ" / "Finish"
- `wizard.reset` -- "Zacznij od nowa" / "Start over"
- `wizard.progress` -- "Krok {{current}} z {{total}}" / "Step {{current}} of {{total}}"

**rooms** -- typy pokoi i akcje:
- `rooms.types.kitchen` -- "Kuchnia" / "Kitchen"
- `rooms.types.bathroom` -- "Łazienka" / "Bathroom"
- `rooms.types.living` -- "Salon" / "Living room"
- `rooms.types.bedroom` -- "Sypialnia" / "Bedroom"
- `rooms.types.hallway` -- "Korytarz" / "Hallway"
- `rooms.types.office` -- "Biuro" / "Office"
- `rooms.types.other` -- "Inne" / "Other"
- `rooms.add` -- "Dodaj pomieszczenie" / "Add room"
- `rooms.remove` -- "Usuń" / "Remove"
- `rooms.edit` -- "Edytuj nazwę" / "Edit name"
- `rooms.editTitle` -- "Zmień nazwę pomieszczenia" / "Rename room"
- `rooms.nameLabel` -- "Nazwa" / "Name"
- `rooms.save` -- "Zapisz" / "Save"
- `rooms.cancel` -- "Anuluj" / "Cancel"
- `rooms.empty` -- "Nie dodano jeszcze żadnych pomieszczeń" / "No rooms added yet"
- `rooms.selectType` -- "Wybierz typ pomieszczenia" / "Select room type"

**dimensions** -- wymiary:
- `dimensions.walls` -- "Ściany" / "Walls"
- `dimensions.wall` -- "Ściana" / "Wall"
- `dimensions.ceilings` -- "Sufity" / "Ceilings"
- `dimensions.ceiling` -- "Sufit" / "Ceiling"
- `dimensions.floor` -- "Posadzka" / "Floor"
- `dimensions.corners` -- "Narożniki" / "Corners"
- `dimensions.grooves` -- "Bruzdy" / "Grooves"
- `dimensions.acrylic` -- "Akrylowanie" / "Acrylic"
- `dimensions.addWall` -- "Dodaj ścianę" / "Add wall"
- `dimensions.addCeiling` -- "Dodaj sufit" / "Add ceiling"
- `dimensions.removeWall` -- "Usuń ścianę" / "Remove wall"
- `dimensions.removeCeiling` -- "Usuń sufit" / "Remove ceiling"
- `dimensions.netArea` -- "Powierzchnia netto" / "Net area"
- `dimensions.unit.m2` -- "m²" / "m²"
- `dimensions.unit.mb` -- "mb" / "mb"
- `dimensions.unit.szt` -- "szt." / "pcs"

**works** -- typy prac:
- `works.types.painting` -- "Malowanie" / "Painting"
- `works.types.priming` -- "Gruntowanie" / "Priming"
- `works.types.plastering` -- "Szpachlowanie" / "Plastering"
- `works.types.floorProtection` -- "Ochrona posadzki" / "Floor protection"
- `works.types.corners` -- "Narożniki" / "Corners"
- `works.types.grooves` -- "Bruzdy" / "Grooves"
- `works.types.acrylic` -- "Akrylowanie" / "Acrylic"
- `works.unitPrice` -- "Cena jedn." / "Unit price"
- `works.quantity` -- "Ilość" / "Quantity"
- `works.cost` -- "Koszt" / "Cost"
- `works.addCustom` -- "Dodaj własną pracę" / "Add custom work"
- `works.customName` -- "Nazwa pracy" / "Work name"
- `works.customUnit` -- "Jednostka" / "Unit"
- `works.customQuantity` -- "Ilość" / "Quantity"
- `works.enabled` -- "Włączona" / "Enabled"
- `works.disabled` -- "Wyłączona" / "Disabled"

**summary** -- podsumowanie:
- `summary.title` -- "Podsumowanie wyceny" / "Estimate summary"
- `summary.room` -- "Pomieszczenie" / "Room"
- `summary.work` -- "Praca" / "Work"
- `summary.subtotal` -- "Suma pokoju" / "Room subtotal"
- `summary.netTotal` -- "Razem netto" / "Net total"
- `summary.vat` -- "VAT" / "VAT"
- `summary.vatRate` -- "Stawka VAT" / "VAT rate"
- `summary.grossTotal` -- "Razem brutto" / "Gross total"
- `summary.exportPdf` -- "Pobierz PDF" / "Download PDF"
- `summary.pdfGenerating` -- "Generowanie..." / "Generating..."
- `summary.pdfFormat` -- "Format PDF" / "PDF format"
- `summary.pdfStandard` -- "Standardowy" / "Standard"
- `summary.pdfTabular` -- "Tabelaryczny" / "Tabular"
- `summary.noRooms` -- "Dodaj pomieszczenia aby zobaczyć wycenę" / "Add rooms to see the estimate"

WAZNE: Polskie znaki diakrytyczne (ą ę ó ź ć ś ł ń ż Ą Ę Ó Ź Ć Ś Ł Ń Ż) MUSZA byc poprawne -- nie zastepuj ASCII.
  </action>
  <verify>
`pnpm build` przechodzi. Pliki JSON sa poprawne (valid JSON). Polskie znaki diakrytyczne sa prawidlowe (grep za "Sciana" zamiast "Ściana" nie powinien znalezc nic).
  </verify>
  <done>Klucze i18n PL/EN dla wizard, rooms, dimensions, works, summary dodane do obu plikow JSON. Istniejace klucze nienaruszone.</done>
</task>

</tasks>

<verification>
1. `pnpm build` przechodzi bez bledow
2. `ls src/types/wizard.ts src/stores/wizard-store.ts src/lib/calc.ts src/lib/format.ts` -- wszystkie pliki istnieja
3. `ls src/components/ui/{progress,skeleton,card,input,switch,badge,dialog}.tsx` -- shadcn komponenty na miejscu
4. Klucze i18n obecne w obu plikach JSON (pl i en)
</verification>

<success_criteria>
- Zustand store importowalny i uzywalny: `useWizardStore((s) => s.rooms)` zwraca tablice
- Store persystuje do localStorage pod kluczem 'renocost-wizard-v1'
- calcGrossFromNet(10000, 23) === 12300 (100 PLN netto -> 123 PLN brutto)
- formatPLN(12300) === "123,00 zł" (lub format zgodny z Intl dla pl-PL)
- Projekt buduje sie bez bledow TypeScript
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-wizard-kalkulator/02-01-SUMMARY.md`
</output>
